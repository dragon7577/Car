(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{11:function(e,t,n){n("201c"),e.exports=n("Z3xQ")},KUpD:function(e,t){e.exports={"install-page-wrapper":"_2145f6w_gvAx5jbCLSvNm1","install-page":"_1ucR52TRm2uhcZJhUjsxqG"}},Z3xQ:function(e,t,n){"use strict";n.r(t);var a=n("zkrS"),r=n("7eYF"),o=n("aqSL"),i=n("lw2U"),s=n("+Cau"),c=n("rbsZ"),l=n("abHt"),d=n("q1tI"),h=n.n(d),p=n("i8i4"),m=n.n(p),u=n("XkTy"),w=n("17x9"),b=n("ldhK"),f=n.n(b);function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var _="/images/sharing/wechat_"+window.MBLocale+".png",x="/images/sharing/ios_"+window.MBLocale+".png",v=function(e){function t(){var n,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=a=g(this,e.call.apply(e,[this].concat(o))),a.handleClick=function(){a.props.onClose()},g(a,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(){var e=this.props.show,t=MB.isWechat(),n=!t&&MB.isIOS(),a=MB.isiPad(),r=!(t||n),o={display:e?"":"none"};return h.a.createElement("div",{className:f.a.covers,style:o,onClick:this.handleClick},t&&h.a.createElement("div",{className:"cover wechat"},h.a.createElement("img",{className:"robot",src:"/images/sharing/robot.png"}),h.a.createElement("img",{className:"tips",src:_}),"s",h.a.createElement("div",{className:"arrow"})),n&&!a&&h.a.createElement("div",{className:"cover ios"},h.a.createElement("img",{className:"robot",src:"/images/sharing/robot.png"}),h.a.createElement("img",{className:"tips",src:x}),h.a.createElement("div",{className:"arrow"})),a&&h.a.createElement("div",{className:"cover ipad"},h.a.createElement("img",{className:"robot",src:"/images/sharing/robot.png"}),h.a.createElement("img",{className:"tips",src:x}),h.a.createElement("div",{className:"arrow"})),r&&h.a.createElement("div",{className:"cover building"},h.a.createElement("div",{className:"tip-wrapper"},h.a.createElement("p",{className:"tip"},I18N.building_apk),h.a.createElement("div",{className:"spinner"}))))},t}(d.PureComponent),k=v;v.propTypes={show:w.PropTypes.bool,onClose:w.PropTypes.func};var y=n("KUpD"),N=n.n(y),z=n("UbMB"),E=n.n(z),P=n("t3Un");var I,j,M=E.a.bind(N.a),S=(I=regeneratorRuntime.mark(function e(t){var n,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return MB.event("移动端: 点击下载 APK","运行页"),e.next=3,Object(P.a)("/app/"+t+"/build/apk.json",null,{method:"PUT"});case 3:return e.next=6,C(5e3);case 6:return e.next=8,Object(P.a)("/app/"+t+"/status/apk.json");case 8:if(n=e.sent,a=n.progress,r=n.link,100===a){e.next=13;break}return e.abrupt("continue",3);case 13:return window.location=r,e.abrupt("return");case 17:case"end":return e.stop()}},e,void 0)}),j=function(){var e=I.apply(this,arguments);return new Promise(function(t,n){return function a(r,o){try{var i=e[r](o),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then(function(e){a("next",e)},function(e){a("throw",e)});t(s)}("next")})},function(e){return j.apply(this,arguments)}),C=function(e){return new Promise(function(t){return setTimeout(t,e)})},B=function(e,t){MB.event("移动端: 点击下载安卓客户端","运行页");var n=window.location,a=n.hostname,r=n.pathname,o=navigator.userAgent.toLowerCase(),i=document.createElement("iframe");if(document.body.appendChild(i),i.style.cssText="display:none;width=0;height=0",setTimeout(function(){window.location=e},200),console.log("userAgent",o),o.includes("chrome")&&o.includes("android")&&!o.includes("ucbrowser")&&!o.includes("quark")){var s="intent://"+a+r+"?password="+t+"#Intent;package=com.mockingbot;scheme=mockingbot;S.browser_fallback_url="+e+";end";i.src=s}else{var c="mockingbot://"+a+r+"?password="+t;window.open(c)}},T=function(e,t){MB.event("移动端: 点击下载 iOS 客户端","运行页");var n=window.location,a="modao://"+n.hostname+n.pathname+"?password="+t;setTimeout(function(){window.location=e},25),window.location=a},O=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return n.handleView=function(e){e.preventDefault(),n.props.loadProject()},n.handleInstall=function(e){e.preventDefault();var t=n.props.project,a=t.accessToken,r=t.userPlan,o=t.exportable;MB.isWechat()?n.setState({isCoverShow:!0}):MB.isiPad()||MB.isIOS()?n.setState({isCoverShow:!0}):o?(n.setState({isCoverShow:!0}),S(a).then(function(){return n.setState({isCoverShow:!1})}).catch(function(e){})):MB.promptRenew("exportable",{format:"apk",role:"project",plan:r})},n.handleDownload=function(e){var t=n.props.encryptedPassword;MB.isWechat()?n.setState({isCoverShow:!0}):MB.isIOS()?T(e,t):MB.isAndroid()&&B(e,t)},n.handleCloseCover=function(){n.setState({isCoverShow:!1})},n.state={isCoverShow:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentDidMount=function(){$("#splash").hide(),$("#workspace").show(),$.timeago.settings.lang=window.MBLocale,$(".timeago").timeago()},t.prototype.render=function(){var e=this,t=this.props.project,n=t.name,a=t.iconUrl,r=t.updatedAt,o=t.ios_client_url,i=t.android_client_url,s=this.state.isCoverShow,c=MB.isAndroid(),l=c?i:o,d=c?I18N.download_android_apk:I18N.add_to_home_screen;return h.a.createElement("div",{className:M("install-page-wrapper")},h.a.createElement("div",{className:M("install-page",{"is-wechat":MB.isWechat()})},h.a.createElement("div",{className:"app-inner"},h.a.createElement("img",{className:"app-icon",src:a}),h.a.createElement("h1",{className:"app-name"},n),h.a.createElement("div",{className:"app-update-time"},h.a.createElement("time",{className:"timeago",dateTime:r}),I18N.update),h.a.createElement("div",{className:"install-btns"},h.a.createElement("a",{className:"install-btn primary",onClick:function(){return e.handleDownload(l)}},I18N.open_in_client),h.a.createElement("a",{className:"install-btn",onClick:this.handleView},I18N.view_app)),h.a.createElement("a",{className:"download-btn",onClick:this.handleInstall},h.a.createElement("span",null,d),h.a.createElement("i",{className:"fa fa-angle-right"}))),h.a.createElement(k,{show:s,onClose:this.handleCloseCover})))},t}(d.PureComponent);O.propTypes={project:w.PropTypes.object,loadProject:w.PropTypes.func,encryptedPassword:w.PropTypes.string};var R=O;function D(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function a(r,o){try{var i=t[r](o),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then(function(e){a("next",e)},function(e){a("throw",e)});e(s)}("next")})}}var A=window,q=A.$,L=A.MB,U=A.MBLocale,W=A.md5,K=A.Pusher,F=A.AutoSaver,G=A.SharingRunner,J=L.localStorageDelegate,Z=function(){return!!window.MBData},H=/\/embed\b/.test(location.pathname);L.f.inSharing=!0,L.load=function(){var e=D(regeneratorRuntime.mark(function e(t){var n,a,r,o,i=t.token,s=t.isPasswordRequired,c=t.encryptedPassword,l=t.installerProject;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(L.webpackInterface.renderPreviewAlert(),n=c||new URLSearchParams(location.search).get("password")||J.getItem(i+"_pwd"),a=!L.isStandAlone()&&!L.isInApp&&L.isMobile()&&!Z()&&!H,L.supportedBrowser()){e.next=7;break}return q("#splash").hide(),q("#loading").hide(),e.abrupt("return");case 7:if(r=L.isMac()?"mac":L.isWindows()?"windows":"other-os",q("html").addClass(r),!a){e.next=15;break}return e.next=12,X({token:i,isPasswordRequired:s,savedEncryptedPassword:n,shouldGetData:!1});case 12:return q("#loading").hide(),e.next=15,new Promise(function(e){m.a.render(h.a.createElement(R,{project:l,loadProject:e,encryptedPassword:n}),document.getElementById("workspace"))});case 15:return e.next=17,X({token:i,isPasswordRequired:s,savedEncryptedPassword:n});case 17:return o=e.sent,e.abrupt("return",Z()?ne(o):o?te(o):null);case 19:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}();var Q,V,Y=(Q=D(regeneratorRuntime.mark(function e(t){var n,a,r,o=t.token,i=t.encryptedPassword,s=t.shouldGetData,c=void 0===s||s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.MBData,!Z()){e.next=5;break}if(!n.project.password||i===n.project.password){e.next=4;break}throw new Error("Wrong password!");case 4:return e.abrupt("return",n);case 5:if(c){e.next=13;break}return e.next=8,fetch("/app/"+o+"/checkpassword?password="+i);case 8:if(a=e.sent,a.ok){e.next=12;break}throw new Error("Wrong password!");case 12:return e.abrupt("return",!0);case 13:return r="/app/"+o+".json?"+(new Date).valueOf()+(i?"&password="+i:""),e.abrupt("return",ee(r));case 15:case"end":return e.stop()}},e,void 0)})),function(e){return Q.apply(this,arguments)}),X=(V=D(regeneratorRuntime.mark(function e(t){var n,a,r=t.token,o=t.isPasswordRequired,i=t.savedEncryptedPassword,s=t.shouldGetData,c=void 0===s||s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,e.prev=1,e.next=4,Y({token:r,shouldGetData:c,encryptedPassword:i});case 4:n=e.sent,e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.log("Invalid saved password: "+e.t0+". Will retry with prompt."),J.removeItem(r+"_pwd");case 11:if(n){e.next=33;break}if(e.prev=12,!o){e.next=25;break}return e.t1=W,e.next=17,Object(u.c)({desc:I18N.credential_required});case 17:return e.t2=e.sent,a=(0,e.t1)(e.t2),e.next=21,Y({token:r,shouldGetData:c,encryptedPassword:a});case 21:n=e.sent,J.setItem(r+"_pwd",a),e.next=26;break;case 25:Object(u.a)({desc:I18N.no_permission_to_app});case 26:e.next=33;break;case 28:return e.prev=28,e.t3=e.catch(12),console.log("Invalid prompt password:",e.t3),setTimeout(function(){return Object(u.a)({desc:o?I18N.invalid_credential:"Failed to load this app."})},320),e.abrupt("return",null);case 33:return e.abrupt("return",n);case 34:case"end":return e.stop()}},e,void 0,[[1,7],[12,28]])})),function(e){return V.apply(this,arguments)}),ee=function(e){return new Promise(function(t,n){return q.getJSON(e,function(e){return t(e)}).fail(function(e,t,a){return n(a)})})},te=function(e){q(".indicator").css("height","100%"),setTimeout(function(){return ae(e)},300)},ne=function(e){L.staticMap=function(){return"images/workspace/staticmap_"+U+".png"},e.project.splash="images/splash.png",e.screens.forEach(function(e){e.bgimage&&(e.bgimage=e.bgimage.replace(/^.+uploads.*?\//,""))}),e.widgets.forEach(function(e){e.image&&(e.image=e.image.replace(/^.+uploads.*?\//,""))}),e.widgetstates.forEach(function(e){e.image&&(e.image=e.image.replace(/^.+uploads.*?\//,""))}),q(".indicator").css("height","100%"),setTimeout(function(){return ae(e)},300)},ae=function(e){var t=e.project.template?new Template:e.project.combo?new Combo:new Project;t.load(e.project),t.lsave(!1),Template.refresh(e.templates),Screen.refresh(e.screens),Widget.refresh(e.widgets),Link.refresh(e.links),Panel.refresh(e.panels),Screenstate.refresh(e.screenstates),Widgetstate.refresh(e.widgetstates),Panelstate.refresh(e.panelstates),Collaborator.refresh(e.collaborators),CommentThread.refresh(e.threads),Comment.refresh(e.comments),Team.refresh(e.teams),L.user=q("#workspace").data("user")||{},L.user.id&&(L.pusher=new K,L.pusher.subscribe(t.cid)),L.isMobile()||(L.autoSaver=new F),(new Image).src=L.staticMap(),q("title").html(t.name),q("#loading").hide(),!t.validated&&L.isMobile()&&Object(u.a)({title:I18N.reminder,desc:I18N.fraud_warning,confirmText:I18N.fraud_confirm,isHTML:!0}),L.checkFA(function(){q(".box").hide(),L.currentProject=t,L.webpackInterface.init(),L.runner=new G(t),L.runner.render()})};n("KKmY"),n("P3rE"),n("dppN");MB.COMPONENTS=l.b;try{a.a.MB.webpackInterface=Object(r.a)(o.a),a.a.MB.setRunnerExtra=i.a,a.a.MB.renewMsg=c.a,a.a.MB.promptRenew=c.c,a.a.MB.messageBucket=Object(s.a)(s.b)}catch(e){console.warn("[UI:Preview] Failed to init:",e.stack||e)}},abHt:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return r});var a=[{name:"label",icon_text:"文字",text:I18N.w.label,tb_text:"文字",icon_name:"text",width:33,height:23,fs:14,br:0,bs:0,ha:"center",va:"middle",z:5,lh:1.45},{name:"text_view",icon_text:"多行文字",text:I18N.w.text_view_placeholder,tb_text:"多行文字",icon_name:"paragraph",width:200,height:65,fs:14,br:0,bs:0,ha:"left",va:"top",z:5,lh:1.45},{name:"rounded_rect",icon_text:"矩形",text:"",icon_name:"rectangle",width:200,height:100,br:0,bs:1,fs:14,ha:"center",va:"middle",lh:1.45,z:5},{name:"circle_rect",icon_text:"圆形",text:"",icon_name:"circle",width:100,height:100,br:100,bs:1,fs:14,ha:"center",va:"middle",lh:1.45,z:5},{name:"triangleb",icon_text:"三角",text:"",icon_name:"triangle-top",width:40,height:30,z:5},{name:"triangletl",icon_text:"三角",text:"",icon_name:"triangle-left-bottom",width:40,height:40,z:5},{name:"hr",icon_text:"线条",text:"",icon_name:"horizontal-line",width:150,height:10,z:5,zoomable:"w,e,n"},{name:"ve",icon_text:"线条",text:"",icon_name:"vertical-line",width:10,height:150,z:5,zoomable:"n,s,w"},{name:"button",icon_text:"按钮",text:I18N.w.button,tb_text:"按钮",icon_name:"btn",width:80,height:30,fs:14,br:4,bs:1,ha:"center",va:"middle",z:5,icon:"",is:14},{name:"image_view",icon_text:"图片",text:"",icon_name:"img",width:200,height:120,br:0,bs:0,z:5},{name:"icon_button",icon_text:"图标",text:"",icon:"star",icon_name:"smile",width:24,height:24,br:0,bs:0,is:24,z:5},{name:"tab_item",icon_text:"标签",text:I18N.w.tab_item,tb_text:"标签",icon_name:"icon-label",icon:"home",width:80,height:45,fs:12,is:24,z:5,ha:"center",zoomable:"w,e"},{name:"lr",icon_text:"链接区域",tb_text:"链接区域",icon_name:"link",width:45,height:45,br:0,bs:0,z:7},{icon_text:"网页",name:"webpage",text:"about:blank",tb_text:"网页",icon_name:"webpage",width:"100%",height:400,z:5,ha:"center"},{name:"pg",icon_text:"全局手势",icon_name:"gesture",icon:"tap",width:40,height:40,br:0,bs:0,z:7,zoomable:" "},{name:"sticky",icon_text:"批注",tb_text:"批注",icon_name:"sticker",width:204,height:170,padding:24,fs:12,lh:1.67,z:10},{name:"mtext_input",icon_text:"单行输入",text:I18N.w.mtext_input,tb_text:"单行输入",icon_name:"input",width:200,height:30,fs:14,br:0,bs:1,ha:"left",va:"middle",z:5,padding:8},{name:"mtextarea",icon_text:"多行输入",text:I18N.w.mtextarea,tb_text:"多行输入",icon_name:"textarea",width:280,height:100,fs:14,lh:1.45,br:0,bs:1,ha:"left",z:5,padding:8},{name:"mselect",icon_text:"下拉框",text:"1\n2\n3",tb_text:"下拉框",icon_name:"select",width:200,height:30,fs:14,bs:1,z:5,lh:1.45,padding:8},{name:"mfile_input",icon_text:"选择文件",tb_text:"文件选择",icon_name:"file",width:200,height:30,z:5,padding:8},{name:"mtooltip",icon_text:"聊天气泡",text:I18N.w.mtooltip,tb_text:"聊天气泡",icon_name:"tooltip",width:220,height:40,fs:14,br:5,ha:"left",va:"top",z:5,lh:1.45,bg:"#8DFA69",bc:"#5FE163",bs:1,padding:10},{name:"map_view",icon_text:"地图",text:"",icon_name:"map",width:"100%",height:230,z:4},{name:"mcheckbox2",icon_text:"复选框",icon_name:"checkbox",width:30,height:30,z:5,checked:!1},{name:"mradiobutton",icon_text:"单选框",icon_name:"radio",width:30,height:30,z:5,checked:!1},{name:"ios_check",icon_text:"多选框",width:22,height:22,z:5,zoomable:" ",checked:!0},{name:"android_check",icon_text:"多选框",width:18,height:18,z:5,zoomable:" ",checked:!0},{name:"android_radio",icon_text:"单选框",width:20,height:20,z:5,zoomable:" ",checked:!1},{name:"switch",icon_text:"开关按钮",text:"",icon_name:"toggle",width:50,height:30,br:0,bs:0,z:5,zoomable:" ",checked:!0},{name:"ios_switch",icon_text:"开关按钮",text:"",icon_name:"toggle",width:50,height:30,br:0,bs:0,z:5,zoomable:" ",checked:!0},{name:"android_switch",icon_text:"开关按钮",text:"",icon_name:"toggle",width:37,height:20,br:0,bs:0,z:5,zoomable:" ",checked:!0},{name:"navigation_bar",icon_text:"标题栏",text:I18N.w.navbar_title,tb_text:"标题栏",icon_name:"header",width:"100%",height:55,fs:18,z:4,zoomable:"s",ha:"center",top:23},{name:"tab_bar",icon_text:"底栏",text:"",tb_text:"底栏",icon_name:"footer",width:"100%",height:45,z:4,zoomable:"n"},{name:"rectangle",icon_text:"空白通栏",text:"",icon_name:"bar",width:"100%",height:100,z:5,zoomable:"n,s"},{name:"search_bar",icon_text:"搜索框",text:I18N.w.search,tb_text:"搜索",icon_name:"search-input",width:"100%",height:45,fs:14,ha:"left",z:5,zoomable:"w,e"},{name:"keyboard",icon_text:"键盘",text:I18N.w.return,width:"100%",icon_name:"keyboard",z:3,zoomable:" ",numeric:!1},{name:"status_bar",icon_text:"状态栏",text:I18N.w.carrier,tb_text:"中国移动",icon_name:"battery",width:"100%",height:23,z:3,zoomable:" "}],r=a.reduce(function(e,t){return e[t.name]=t,e},{})},ldhK:function(e,t){e.exports={covers:"_2fva7dqNrMTA3qQj2Sag2u"}}},[[11,0,1,2]]]);
//# sourceMappingURL=preview-834f06e3bbf366ea0afa.js.map